{{ layout:layout }}

<div class="container mx-auto px-4 py-8 md:py-12">
    {{# Page Header #}}
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">{{ title }}</h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Discover our latest insights, tutorials, and stories from the world of technology and design.
        </p>
    </div>

    {{# Alpine.js Blog Filter Component #}}
    <div x-data="blogFeed()" class="space-y-8">
        {{# Filter Controls #}}
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <div class="flex flex-col lg:flex-row gap-6 items-start lg:items-center justify-between">
                {{# Search Bar #}}
                <div class="flex-1 max-w-md">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <input
                            :value="state.q"
                            @input.debounce.300ms="onSearchInput($event)"
                            type="text" 
                            placeholder="Search posts..." 
                            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                        >
                    </div>
                </div>

                {{# Category Filter Tabs #}}
                <div class="flex flex-wrap gap-2">
                    <button 
                        @click="setCategory('all')" 
                        :class="{ 'bg-indigo-600 text-white': state.category === 'all', 'bg-gray-100 text-gray-700 hover:bg-gray-200': state.category !== 'all' }"
                        class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    >
                        All Posts
                    </button>
                    <template x-for="cat in categories" :key="cat.slug">
                        <button 
                            @click="setCategory(cat.slug)" 
                            :class="{ 'bg-indigo-600 text-white': state.category === cat.slug, 'bg-gray-100 text-gray-700 hover:bg-gray-200': state.category !== cat.slug }"
                            :data-category-slug="cat.slug"
                            class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                            x-text="cat.title"
                        ></button>
                    </template>
                </div>
            </div>

            {{# Active Filters Display #}}
            <div x-show="state.category !== 'all' || state.q" x-transition class="mt-4 pt-4 border-t border-gray-200">
                <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-600">Active filters:</span>
                <span x-show="state.category !== 'all'" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                    <span x-text="getCategoryTitle(state.category)"></span>
                        <button @click="clearCategoryFilter" class="ml-1 text-indigo-600 hover:text-indigo-800">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </span>
                    <span x-show="state.q" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        Search: "<span x-text="state.q"></span>"
                        <button @click="clearSearch" class="ml-1 text-green-600 hover:text-green-800">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </span>
                    <button 
                        @click="clearAllFilters" 
                        class="text-sm text-indigo-600 hover:text-indigo-800 font-medium"
                    >
                        Clear all
                    </button>
                </div>
            </div>
        </div>

        {{# Results Summary #}}
        <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">
                <span x-text="`Showing ${page.from} to ${page.to} of ${page.total}`"></span>
                <span x-show="state.q || state.category !== 'all'" x-text="` (filtered)`"></span>
            </div>
            
            {{# Sort Options #}}
            <div class="flex items-center gap-2">
                <label class="text-sm text-gray-600">Sort by:</label>
                <select
                    x-model="state.sort"
                    @change="onSortChange"
                    class="text-sm border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                >
                    <option value="date:desc">Newest First</option>
                    <option value="date:asc">Oldest First</option>
                    <option value="title:asc">Title A-Z</option>
                    <option value="title:desc">Title Z-A</option>
                </select>
            </div>
        </div>

        {{# Loading State #}}
        <div x-show="loading" x-transition class="flex justify-center py-12">
            <div class="flex items-center space-x-2">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div>
                <span class="text-gray-600">Loading posts...</span>
            </div>
        </div>

        {{# Posts Grid (fetched) #}}
        <div
            x-show="!loading"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-y-4"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        >
            <template x-for="post in posts" :key="post.id">
                <div class="blog-post-card bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                    <div class="relative overflow-hidden">
                        <a :href="post.url" class="block">
                            <img :src="post.featured_image" :alt="post.title" class="w-full h-48 object-cover transition-transform duration-500 hover:scale-105" loading="lazy" />
                        </a>
                        <div class="absolute top-3 left-3 flex flex-wrap gap-1 max-w-[calc(100%-1.5rem)]">
                            <template x-for="cat in post.categories" :key="cat.slug">
                                <span class="inline-block px-2 py-1 text-xs font-medium text-white bg-indigo-600 rounded-full whitespace-nowrap" x-text="cat.title"></span>
                            </template>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="flex flex-wrap gap-1 mb-3">
                            <template x-for="cat in post.categories" :key="cat.slug">
                                <span class="inline-block px-2 py-1 text-xs font-medium text-indigo-700 bg-indigo-50 rounded-md" x-text="cat.title"></span>
                            </template>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-3 line-clamp-2">
                            <a :href="post.url" class="hover:text-indigo-600 transition-colors duration-200" x-text="post.title"></a>
                        </h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3" x-text="post.excerpt"></p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div></div>
                            <time :datetime="post.date" x-text="new Date(post.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })"></time>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        {{# No Results Message #}}
        <div 
            x-show="posts.length === 0 && !loading" 
            x-transition
            class="text-center py-12"
        >
            <div class="max-w-md mx-auto">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No posts found</h3>
                <p class="mt-1 text-sm text-gray-500">
                    <span x-show="state.q">No posts match your search criteria.</span>
                    <span x-show="!state.q && state.category !== 'all'">No posts found in this category.</span>
                </p>
                <div class="mt-6">
                    <button 
                        @click="clearAllFilters" 
                        class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                    >
                        Clear filters
                    </button>
                </div>
            </div>
        </div>

        {{# Pagination Controls (fetched) #}}
        <div x-show="page.total > state.limit" class="flex items-center justify-center space-x-4 pt-8">
            {{# Previous Button #}}
            <button 
                @click="prevPage" 
                :disabled="state.page === 1 || loading"
                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
            >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Previous
            </button>

            {{# Page Numbers #}}
            <div class="flex items-center space-x-2">
                <template x-for="p in pageNumbers" :key="p">
                    <template x-if="p !== '...'">
                        <button 
                            @click="goToPage(p)"
                            :class="{ 'bg-indigo-600 text-white': p === state.page, 'bg-white text-gray-700 hover:bg-gray-50': p !== state.page }"
                            class="px-3 py-2 text-sm font-medium border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"
                            x-text="p"
                        ></button>
                    </template>
                    <template x-if="p === '...'">
                        <span class="px-3 py-2 text-sm text-gray-500">...</span>
                    </template>
                </template>
            </div>

            {{# Next Button #}}
            <button 
                @click="nextPage" 
                :disabled="state.page >= totalPages || loading"
                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
            >
                Next
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>

        {{# Page Info (fetched) #}}
        <div x-show="page.total > 0" class="text-center pt-4">
            <p class="text-sm text-gray-600">
                Showing <span x-text="page.from"></span> to <span x-text="page.to"></span> of <span x-text="page.total"></span> posts
                <span x-show="page.total > state.limit"> (Page <span x-text="state.page"></span> of <span x-text="totalPages"></span>)</span>
            </p>
        </div>

        {{# End of Results Message #}}
        <div 
            x-show="posts.length === 0 && !loading" 
            x-transition
            class="text-center py-8 border-t border-gray-200"
        >
            <p class="text-gray-500 text-sm">
                <span x-show="state.q">No posts match your search criteria.</span>
                <span x-show="!state.q && state.category !== 'all'">No posts found in this category.</span>
            </p>
        </div>
    </div>
</div>
